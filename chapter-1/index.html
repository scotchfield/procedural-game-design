<!--

Procedural Generation in Game Design
Chapter 1

Darren Grey: "What would a game based on the player's Twitter account and
followers look like?"

Twitter doesn't make it easy to get information without an API key. To make
this example more accessible, we can make a request using a public service
that ignores the Cross-Origin server response from Twitter. However, we can't
get the followers list that way. Darn!

-->

<html>
  <head id="head">
    <title>Twitter Game</title>
  </head>
  <body>

<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript">

$(function () {
  var username = 'scotchfield';
  var urlTweets = 'https://twitter.com/' + username;

  // We have to bypass CORS to load the data, pass through
  // this lovely website ❤️
  urlTweets = 'https://crossorigin.me/' + urlTweets;

  fetch(urlTweets).then(function(response) {
    return response.text();
  }).then(function (data) {
    // We're retrieving the HTML data. Store it in a new element
    // that doesn't show up in browser, and use jQuery to identify
    // the profile image and the tweets.
    var el = $(data);
    var img = el.find('img.ProfileAvatar-image')[0].src;
    var tweets = el.find('p.tweet-text')
      .map(function () { return $(this).text(); })
      .get();

    game.init({img: img, tweets: tweets});
    game.update();
  });

});

// We can make a game with this! Store some data in a closure.
var game = (function () {
  var img = '', tweets = [];

  return {
    init: function(obj) {
      img = obj.img || img;
      tweets = obj.tweets || tweets;
    },
    update: function () {
      console.log('update');
      console.log(img);
      console.log(tweets);
    },
  }
})();

</script>

<div id="app">Loading..</div>

  </body>
</html>
